<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap       
    PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"       
    "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<!-- namespace: 테이블명 사용 -->
<sqlMap namespace="sol_calendar">
	<typeAlias alias="MypageDTO" type="kr.co.solproject.mypage.MypageDTO" />
	<typeAlias alias="StudyDTO" type="kr.co.solproject.study.StudyDTO" />

	<select id="getpromise" parameterClass="String" resultClass="String">
		select
		promise
		from sol_member
		where id = #id#
	</select>

	<select id="getname" parameterClass="String" resultClass="String">
		select
		name
		from sol_member
		where id = #id#
	</select>

	<select id="getstudytable" parameterClass="String" resultClass="int">
		select
		count(*)
		from sol_study
		where id = #id#
	</select>

	<select id="checkcount" parameterClass="Map" resultClass="int">
		SELECT count(*) FROM sol_calendar
		WHERE id=#id# AND lectureno=#lectureno#
	</select>

	<select id="checkrdt" parameterClass="Map" resultClass="String">
		SELECT max(regdate) FROM sol_calendar
		WHERE id=#id# AND lectureno=#lectureno#
	</select>

	<select id="checkcalno" parameterClass="Map" resultClass="String">
		SELECT max(calno) FROM sol_calendar
		WHERE id=#id# AND lectureno=#lectureno#
	</select>

	<select id="check" parameterClass="Map" resultClass="String">
		SELECT regdate FROM sol_calendar
		WHERE id=#id# AND lectureno=#lectureno#
	</select>


	<insert id="calinsert" parameterClass="Map">
		INSERT INTO
		sol_calendar(lectureno, id, regdate)
		VALUES (#lectureno#, #id#, now())
	</insert>

	<update id="calupdate" parameterClass="Map">
		update sol_calendar
		set regdate = now()
		where id=#id# and lectureno = #lectureno# and calno=#calno#
	</update>


	<select id="getregdate" parameterClass="String" resultClass="MypageDTO">
		select
		regdate
		from sol_calendar
		where id = #id#
	</select>


	<select id="getMemoList" resultClass="MypageDTO">
		SELECT
		study.id,study.lectureno,study.memo,study.memodate,calendar.regdate
		FROM sol_calendar calendar join sol_study study
		ON calendar.lectureno =
		study.lectureno
		where calendar.id=study.id
	</select>
	
<!-- 	SELECT t1.col, t3.col FROM table1 join table2 ON table1.primarykey = table2.foreignkey
                                  join table3 ON table2.primarykey = table3.foreignkey

	 -->
	<select id="getLectureList" resultClass="MypageDTO">
        SELECT
        lecture.lectureno, lecture.subject,lecture.poster,lecture.teacher,calendar.regdate,calendar.id,study.memo,study.memodate
        FROM sol_calendar calendar join sol_study study
        ON calendar.lectureno =  study.lectureno
        join sol_lecture lecture on study.lectureno = lecture.lectureno
        where calendar.id=study.id
    </select>
    

</sqlMap> 
